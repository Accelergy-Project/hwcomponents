

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Making Models &mdash; HWComponents 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Finding and Using Models" href="finding_and_using_models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HWComponents
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">hwcomponents</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="finding_and_using_models.html">Finding and Using Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Making Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-components">Basic Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scaling-by-number-of-bits">Scaling by Number of Bits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compound-models">Compound Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-models-and-making-them-globally-visible">Installing Models and Making them Globally Visible</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HWComponents</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Making Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notes/making_models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="making-models">
<h1>Making Models<a class="headerlink" href="#making-models" title="Link to this heading"></a></h1>
<p>This document follows the <code class="docutils literal notranslate"><span class="pre">2_making_models.ipynb</span></code> tutorial.</p>
<section id="basic-components">
<h2>Basic Components<a class="headerlink" href="#basic-components" title="Link to this heading"></a></h2>
<p>Models can be created by subclassing the <a class="reference internal" href="../hwcomponents.html#hwcomponents.model.ComponentModel" title="hwcomponents.model.ComponentModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComponentModel</span></code></a>
class. Models estimate the energy, area, and leakage power of a component. Each model
requires the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">component_name</span></code>: The name of the component. This may also be a list of components if
multiple aliases are used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code>: This is used to break ties if multiple models support a given query.</p></li>
<li><p>A call to <code class="docutils literal notranslate"><span class="pre">super().__init__(area,</span> <span class="pre">leak_power,</span> <span class="pre">subcomponents)</span></code>. This is used to
initialize the model and set the area and leakage power.</p></li>
</ul>
<p>Models can also have actions. Actions are functions that return a tuple of <code class="docutils literal notranslate"><span class="pre">(energy,</span>
<span class="pre">latency)</span></code> for a specific action. For the TernaryMAC model, we have an action called
<code class="docutils literal notranslate"><span class="pre">mac</span></code> that returns the energy and latency of a ternary MAC operation. The
<a class="reference internal" href="../hwcomponents.html#hwcomponents.model.action" title="hwcomponents.model.action"><code class="xref py py-func docutils literal notranslate"><span class="pre">action()</span></code></a> decorator makes this function visible as an
action. The function should return <code class="docutils literal notranslate"><span class="pre">(energy_in_Joules,</span> <span class="pre">latency_in_seconds)</span></code>.</p>
<p>Models can also be scaled to support a range of different parameters. For example,
the TernaryMAC model can be scaled to support a range of different technology nodes.
This is done by calling the <code class="docutils literal notranslate"><span class="pre">self.scale</span></code> function in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method of the
model. The <code class="docutils literal notranslate"><span class="pre">self.scale</span></code> function takes the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parameter_name</span></code>: The name of the parameter to scale.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameter_value</span></code>: The value of the parameter to scale.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_value</span></code>: The reference value of the parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area_scaling_function</span></code>: The scaling function to use for area. Use <code class="docutils literal notranslate"><span class="pre">None</span></code> if no
scaling should be done.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">energy_scaling_function</span></code>: The scaling function to use for dynamic energy. Use
<code class="docutils literal notranslate"><span class="pre">None</span></code> if no scaling should be done.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latency_scaling_function</span></code>: The scaling function to use for latency. Use <code class="docutils literal notranslate"><span class="pre">None</span></code> if
no scaling should be done.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">leak_scaling_function</span></code>: The scaling function to use for leakage power. Use <code class="docutils literal notranslate"><span class="pre">None</span></code>
if no scaling should be done.</p></li>
</ul>
<p><strong>Note: Area, Energy, Latency, and Leak Power are always in alphabetical order in the
function arguments.</strong></p>
<p>Many different scaling functions are defined and available in
<a class="reference internal" href="../hwcomponents.scaling.html#module-hwcomponents.scaling" title="hwcomponents.scaling"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hwcomponents.scaling</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hwcomponents</span> <span class="kn">import</span> <span class="n">ComponentModel</span><span class="p">,</span> <span class="n">action</span>
<span class="kn">from</span> <span class="nn">hwcomponents.scaling</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">tech_node_area</span><span class="p">,</span>
    <span class="n">tech_node_energy</span><span class="p">,</span>
    <span class="n">tech_node_leak</span><span class="p">,</span>
    <span class="n">tech_node_latency</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">TernaryMAC</span><span class="p">(</span><span class="n">ComponentModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    A ternary MAC unit, which multiplies two ternary values and accumulates the result.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    accum_n_bits : int</span>
<span class="sd">        The width of the accumulator in bits.</span>
<span class="sd">    tech_node : int</span>
<span class="sd">        The technology node in meters.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    accum_n_bits : int</span>
<span class="sd">        The width of the accumulator in bits.</span>
<span class="sd">    tech_node : int</span>
<span class="sd">        The technology node in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TernaryMAC&#39;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Name of the component. Must be a string or list/tuple of strings. &quot;&quot;&quot;</span>

    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Priority determines which model is used when multiple models are available for a</span>
<span class="sd">    given component. Higher priority models are used first. Must be a number between 0</span>
<span class="sd">    and 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accum_n_bits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tech_node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Provide an area and leakage power for the component. All units are in</span>
        <span class="c1"># standard units without any prefixes (Joules, Watts, meters, etc.).</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">area</span><span class="o">=</span><span class="mf">5e-12</span> <span class="o">*</span> <span class="n">accum_n_bits</span><span class="p">,</span>
            <span class="n">leak_power</span><span class="o">=</span><span class="mf">1e-3</span> <span class="o">*</span> <span class="n">accum_n_bits</span>
        <span class="p">)</span>

        <span class="c1"># The following scales the tech_node to the given tech_node node from 40nm.</span>
        <span class="c1"># The scaling functions for area, energy, and leakage are defined in</span>
        <span class="c1"># hwcomponents.scaling. The energy scaling will affect the functions decorated</span>
        <span class="c1"># with @action.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tech_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
            <span class="s2">&quot;tech_node&quot;</span><span class="p">,</span>
            <span class="n">tech_node</span><span class="p">,</span>
            <span class="mf">40e-9</span><span class="p">,</span>
            <span class="n">tech_node_area</span><span class="p">,</span>
            <span class="n">tech_node_energy</span><span class="p">,</span>
            <span class="n">tech_node_latency</span><span class="p">,</span>
            <span class="n">tech_node_leak</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accum_n_bits</span> <span class="o">=</span> <span class="n">accum_n_bits</span>

        <span class="c1"># Raising an error says that this model can&#39;t estimate and other models instead</span>
        <span class="c1"># should be used instead. Good error messages are essential for users debugging</span>
        <span class="c1"># their designs.</span>
        <span class="k">assert</span> <span class="mi">4</span> <span class="o">&lt;=</span> <span class="n">accum_n_bits</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">,</span> \
            <span class="sa">f</span><span class="s1">&#39;Accumulation number of bits </span><span class="si">{</span><span class="n">accum_n_bits</span><span class="si">}</span><span class="s1"> outside supported range [4, 8]&#39;</span>

    <span class="c1"># The action decorator makes this function visible as an action. The</span>
    <span class="c1"># function should return a tuple of (energy, latency).</span>
    <span class="nd">@action</span>
    <span class="k">def</span> <span class="nf">mac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock_gated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the energy and latency to perform a ternary MAC operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        clock_gated : bool</span>
<span class="sd">            Whether the MAC is clock gated during this operation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (energy, latency)</span>
<span class="sd">            The energy in Joules and latency in seconds for a ternary MAC operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TernaryMAC Model is estimating &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;energy for mac_random.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clock_gated</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mf">0.002e-12</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accum_n_bits</span> <span class="o">+</span> <span class="mf">0.25</span><span class="p">),</span> <span class="mf">0.0</span>

<span class="n">mac</span> <span class="o">=</span> <span class="n">TernaryMAC</span><span class="p">(</span><span class="n">accum_n_bits</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">tech_node</span><span class="o">=</span><span class="mf">16e-9</span><span class="p">)</span> <span class="c1"># Scale the TernaryMAC to 16nm</span>
<span class="n">e</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">mac</span><span class="o">.</span><span class="n">mac</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TernaryMAC energy is </span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">J (latency </span><span class="si">{</span><span class="n">l</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">s). Area is </span><span class="si">{</span><span class="n">mac</span><span class="o">.</span><span class="n">area</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">m^2. Leak power is </span><span class="si">{</span><span class="n">mac</span><span class="o">.</span><span class="n">leak_power</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">W&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="scaling-by-number-of-bits">
<h2>Scaling by Number of Bits<a class="headerlink" href="#scaling-by-number-of-bits" title="Link to this heading"></a></h2>
<p>Some actions may depend on the number of bits being accessesed. For example, you may
want to charge for the energy and latency per bit of a DRAM read. To do this, you can
use the <code class="docutils literal notranslate"><span class="pre">bits_per_action</span></code> argument of the <a class="reference internal" href="../hwcomponents.html#hwcomponents.model.action" title="hwcomponents.model.action"><code class="xref py py-func docutils literal notranslate"><span class="pre">action()</span></code></a>
decorator. This decorator takes a string that is the name of the parameter to scale by.
For example, we can scale the energy and latency of a DRAM read by the number of bits
being read. In this example, the DRAM yields <code class="docutils literal notranslate"><span class="pre">width</span></code> bits per read, so energy and
latency are scaled by <code class="docutils literal notranslate"><span class="pre">bits_per_action</span> <span class="pre">/</span> <span class="pre">width</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">class</span> <span class="nc">LPDDR4</span><span class="p">(</span><span class="n">ComponentModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    LPDDR4 DRAM energy model.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">component_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DRAM&quot;</span><span class="p">,</span> <span class="s2">&quot;dram&quot;</span><span class="p">]</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="mf">100e-3</span><span class="p">,</span> <span class="n">leak_power</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># If read() is called with a different bits_per_action, the energy will be scaled</span>
    <span class="c1"># by the number of bits.</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the energy to read data from the DRAM.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bits_per_action : int</span>
<span class="sd">            The number of bits to read.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The energy to read the data in Joules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">8e-12</span><span class="p">,</span> <span class="mi">0</span>


<span class="n">lpddr4</span> <span class="o">=</span> <span class="n">LPDDR4</span><span class="p">()</span>
<span class="n">energy1</span><span class="p">,</span> <span class="n">latency1</span> <span class="o">=</span> <span class="n">lpddr4</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">energy50</span><span class="p">,</span> <span class="n">latency50</span> <span class="o">=</span> <span class="n">lpddr4</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read energy for one bit: </span><span class="si">{</span><span class="n">energy1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read energy for fifty bits: </span><span class="si">{</span><span class="n">energy50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read latency for one bit: </span><span class="si">{</span><span class="n">latency1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read latency for fifty bits: </span><span class="si">{</span><span class="n">latency50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compound-models">
<h2>Compound Models<a class="headerlink" href="#compound-models" title="Link to this heading"></a></h2>
<p>We can create compound models by combining multiple component models. Here, we’ll show
the <code class="docutils literal notranslate"><span class="pre">SmartBufferSRAM</span></code> model from the <code class="docutils literal notranslate"><span class="pre">hwcomponents-library</span></code> package.This is an SRAM
with an address generator that sequentially reads addresses in the SRAM.</p>
<p>We’ll use the following components:</p>
<ul class="simple">
<li><p>A SRAM buffer</p></li>
<li><p>Two registers: one that that holds the current address, and one that holds the
increment value</p></li>
<li><p>An adder that adds the increment value to the current address</p></li>
</ul>
<p>One new functionality is used here. The <code class="docutils literal notranslate"><span class="pre">subcomponents</span></code> argument to the
<a class="reference internal" href="../hwcomponents.html#hwcomponents.model.ComponentModel" title="hwcomponents.model.ComponentModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComponentModel</span></code></a> constructor is used to register
subcomponents.</p>
<p>The area, energy, latency, and leak power of subcomponents will NOT be scaled by the
component’s <code class="docutils literal notranslate"><span class="pre">area_scale</span></code>, <code class="docutils literal notranslate"><span class="pre">energy_scale</span></code>, <code class="docutils literal notranslate"><span class="pre">latency_scale</span></code>, and
<code class="docutils literal notranslate"><span class="pre">leak_power_scale</span></code>; if you want to scale the subcomponents, multiply the
subcomponents’ <code class="docutils literal notranslate"><span class="pre">area_scale</span></code>, <code class="docutils literal notranslate"><span class="pre">energy_scale</span></code>, <code class="docutils literal notranslate"><span class="pre">latency_scale</span></code>, and
<code class="docutils literal notranslate"><span class="pre">leak_power_scale</span></code> by the desired scale factor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">hwcomponents_cacti</span> <span class="kn">import</span> <span class="n">SRAM</span>
<span class="kn">from</span> <span class="nn">hwcomponents_library</span> <span class="kn">import</span> <span class="n">AladdinAdder</span><span class="p">,</span> <span class="n">AladdinRegister</span>
<span class="kn">from</span> <span class="nn">hwcomponents</span> <span class="kn">import</span> <span class="n">ComponentModel</span><span class="p">,</span> <span class="n">action</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">class</span> <span class="nc">SmartBufferSRAM</span><span class="p">(</span><span class="n">ComponentModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An SRAM with an address generator that sequentially reads addresses in the SRAM.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        tech_node: The technology node in meters.</span>
<span class="sd">        width: The width of the read and write ports in bits. This is the number of bits</span>
<span class="sd">            that are accssed by any one read/write. Total size = width * depth.</span>
<span class="sd">        depth: The number of entries in the SRAM, each with `width` bits. Total size =</span>
<span class="sd">            width * depth.</span>
<span class="sd">        n_rw_ports: The number of read/write ports. Bandwidth will increase with more</span>
<span class="sd">            ports.</span>
<span class="sd">        n_banks: The number of banks. Bandwidth will increase with more banks.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        sram: The SRAM buffer.</span>
<span class="sd">        address_reg: The register that holds the current address.</span>
<span class="sd">        delta_reg: The register that holds the increment value.</span>
<span class="sd">        adder: The adder that adds the increment value to the current address.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">component_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;smart_buffer_sram&quot;</span><span class="p">,</span> <span class="s2">&quot;smartbuffer_sram&quot;</span><span class="p">,</span> <span class="s2">&quot;smartbuffersram&quot;</span><span class="p">]</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">tech_node</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">n_rw_ports</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">n_banks</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sram</span><span class="p">:</span> <span class="n">SRAM</span> <span class="o">=</span> <span class="n">SRAM</span><span class="p">(</span>
            <span class="n">tech_node</span><span class="o">=</span><span class="n">tech_node</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
            <span class="n">n_rw_ports</span><span class="o">=</span><span class="n">n_rw_ports</span><span class="p">,</span>
            <span class="n">n_banks</span><span class="o">=</span><span class="n">n_banks</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_bits</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">depth</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">address_reg</span> <span class="o">=</span> <span class="n">AladdinRegister</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address_bits</span><span class="p">,</span> <span class="n">tech_node</span><span class="o">=</span><span class="n">tech_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_reg</span> <span class="o">=</span> <span class="n">AladdinRegister</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address_bits</span><span class="p">,</span> <span class="n">tech_node</span><span class="o">=</span><span class="n">tech_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adder</span> <span class="o">=</span> <span class="n">AladdinAdder</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address_bits</span><span class="p">,</span> <span class="n">tech_node</span><span class="o">=</span><span class="n">tech_node</span><span class="p">)</span>


        <span class="c1"># If there are subcomponents, we can omit the leakage power and area in the</span>
        <span class="c1"># super constructor. If we pass them, their values will be added to the total.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subcomponents</span><span class="o">=</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sram</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">address_reg</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delta_reg</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adder</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="nd">@action</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">pipelined_subcomponents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the energy consumed by a read operation in Joules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bits_per_action: int</span>
<span class="sd">            The number of bits to read.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The energy consumed by a read operation in Joules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can omit the return value if there are subcomponents; return value is assumed</span>
        <span class="c1"># to be sum of subcomponents. Return something to add it to the sum.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sram</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_reg</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_reg</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adder</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>

    <span class="nd">@action</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">pipelined_subcomponents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the energy consumed by a write operation in Joules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bits_per_action: int</span>
<span class="sd">            The number of bits to write.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The energy consumed by a write operation in Joules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can omit the return value if there are subcomponents; return value is assumed</span>
        <span class="c1"># to be sum of subcomponents. Return something to add it to the sum.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_reg</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_reg</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adder</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>


<span class="n">smartbuffer_sram</span> <span class="o">=</span> <span class="n">SmartBufferSRAM</span><span class="p">(</span>
    <span class="n">tech_node</span><span class="o">=</span><span class="mf">16e-9</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">n_rw_ports</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_banks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">read_energy</span><span class="p">,</span> <span class="n">read_latency</span> <span class="o">=</span> <span class="n">smartbuffer_sram</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">write_energy</span><span class="p">,</span> <span class="n">write_latency</span> <span class="o">=</span> <span class="n">smartbuffer_sram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bits_per_action</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Read energy: </span><span class="si">{</span><span class="n">read_energy</span><span class="si">}</span><span class="s1"> J&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Write energy: </span><span class="si">{</span><span class="n">write_energy</span><span class="si">}</span><span class="s1"> J&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Read latency: </span><span class="si">{</span><span class="n">read_latency</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Write latency: </span><span class="si">{</span><span class="n">write_latency</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Area: </span><span class="si">{</span><span class="n">smartbuffer_sram</span><span class="o">.</span><span class="n">area</span><span class="si">}</span><span class="s1"> m^2&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Leak power: </span><span class="si">{</span><span class="n">smartbuffer_sram</span><span class="o">.</span><span class="n">leak_power</span><span class="si">}</span><span class="s1"> W&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The latency of subcomponents is generally summed. However, if the subcomponents are
pipelined for a given action, then the <code class="docutils literal notranslate"><span class="pre">pipelined_subcomponents</span></code> argument to the
<a class="reference internal" href="../hwcomponents.html#hwcomponents.model.action" title="hwcomponents.model.action"><code class="xref py py-func docutils literal notranslate"><span class="pre">action()</span></code></a> decorator should be set to True. This will cause
the latency of the action to be the max of the latency returned and all subcomponent
latencies.</p>
</section>
<section id="installing-models-and-making-them-globally-visible">
<h2>Installing Models and Making them Globally Visible<a class="headerlink" href="#installing-models-and-making-them-globally-visible" title="Link to this heading"></a></h2>
<p>An example model is provided in the <code class="docutils literal notranslate"><span class="pre">notebooks/model_example</span></code> directory, which can be
installed with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>notebooks/model_example
pip3<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file in the <code class="docutils literal notranslate"><span class="pre">notebooks/model_example</span></code> directory contains information
on how to make models installable. Keep the following in mind while you’re changing the
model:</p>
<ul class="simple">
<li><p>The model name should be prefixed with <code class="docutils literal notranslate"><span class="pre">hwcomponents_</span></code>. This allows HWComponents
to find the model when it is installed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file should import all Model classes that you’d like to be
visible to HWComponents.</p></li>
<li><p>If you’re iterating on an model, you can use the <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> command to
install the model in editable mode. This allows you to make changes to the
model without having to reinstall it.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="finding_and_using_models.html" class="btn btn-neutral float-left" title="Finding and Using Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>